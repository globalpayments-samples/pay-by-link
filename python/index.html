<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Payments - Pay by Link</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://globalpayments-samples.github.io/css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="gp-header">
        <div class="gp-container">
            <div class="gp-header-content">
                <div class="gp-logo">
                    <picture>
                        <source media="(min-width: 768px)" srcset="https://globalpayments-samples.github.io/assets/img/GP_logo.svg">
                        <img src="https://globalpayments-samples.github.io/assets/img/GP_favicon.svg" alt="Global Payments" style="height: 32px; width: auto;">
                    </picture>
                </div>
                <nav class="gp-header-nav">
                    <a href="https://developer.globalpay.com/">Documentation</a>
                    <a href="https://developer.globalpay.com/api">API Reference</a>
                    <a href="https://developer.globalpay.com/sdks">SDKs</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="gp-container">
        <!-- Page Title -->
        <h1 class="gp-page-title">Pay by Link Generator</h1>
        <p class="gp-page-subtitle">Create secure payment links for your customers using Global Payments API.</p>

        <!-- Payment Link Form -->
        <div class="gp-card">
            <div class="gp-card-header">
                <h2 class="gp-card-title">Create Payment Link</h2>
                <p class="gp-card-description">
                    Generate a secure payment link that can be shared with customers via email, SMS, or other channels.
                </p>
            </div>

            <form id="payment-link-form" class="gp-form" method="POST" action="create-payment-link">
                <div class="gp-form-row">
                    <div class="gp-form-group">
                        <label for="amount" class="gp-label">Amount (cents):</label>
                        <input type="number" id="amount" name="amount" class="gp-input" min="1" step="1" value="1000" required>
                        <small class="gp-form-help">Enter amount in cents (e.g., 1000 = €10.00)</small>
                    </div>

                    <div class="gp-form-group">
                        <label for="currency" class="gp-label">Currency:</label>
                        <select id="currency" name="currency" class="gp-select" required>
                            <option value="EUR">EUR</option>
                            <option value="USD">USD</option>
                            <option value="GBP">GBP</option>
                        </select>
                    </div>
                </div>

                <div class="gp-form-group">
                    <label for="reference" class="gp-label">Reference:</label>
                    <input type="text" id="reference" name="reference" class="gp-input" placeholder="Invoice #1234567" value="Invoice #1234567" required>
                </div>

                <div class="gp-form-group">
                    <label for="name" class="gp-label">Payment Name:</label>
                    <input type="text" id="name" name="name" class="gp-input" placeholder="Invoice #1234567" value="Invoice #1234567" required>
                </div>

                <div class="gp-form-group">
                    <label for="description" class="gp-label">Description:</label>
                    <textarea id="description" name="description" class="gp-input" rows="3" placeholder="Your order description" required>Your order description</textarea>
                </div>

                <button type="submit" class="gp-button gp-button-primary gp-button-full">
                    Create Payment Link
                </button>
            </form>

            <!-- Result Display -->
            <div id="result" class="gp-hidden gp-mt-lg">
                <h3 class="gp-card-title">Payment Link Created Successfully!</h3>
                <div class="gp-alert gp-alert-success">
                    <div id="result-content"></div>
                </div>
            </div>

            <!-- Error Display -->
            <div id="error" class="gp-hidden gp-mt-lg">
                <div class="gp-alert gp-alert-error">
                    <strong>Error:</strong> <span id="error-content"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <!--
        DEVELOPER NOTE: Update the following footer information to match your business:
        - Company name and copyright year
        - Update all links to point to your actual Terms of Service, Privacy Policy, and Refund Policy pages
        - Refund Policy link is typically required by payment processor underwriting in addition to Terms and Privacy
        - Ensure all linked policies are accessible and up-to-date before going live
    -->
    <footer class="gp-footer">
        <div class="gp-container">
            <div class="gp-footer-content">
                <div class="gp-footer-section">
                    <p class="gp-footer-copyright">
                        © 2024 Your Company Name. All rights reserved.
                    </p>
                </div>
                <div class="gp-footer-section">
                    <nav class="gp-footer-nav">
                        <a href="/terms-of-service" class="gp-footer-link">Terms of Service</a>
                        <a href="/privacy-policy" class="gp-footer-link">Privacy Policy</a>
                        <a href="/refund-policy" class="gp-footer-link">Refund Policy</a>
                    </nav>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('payment-link-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Hide previous results/errors
            document.getElementById('result').classList.add('gp-hidden');
            document.getElementById('error').classList.add('gp-hidden');

            // Show loading state
            const submitButton = document.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Creating Link...';
            submitButton.disabled = true;

            // Get form values
            const formValues = {
                amount: document.getElementById('amount').value,
                currency: document.getElementById('currency').value,
                reference: document.getElementById('reference').value,
                name: document.getElementById('name').value,
                description: document.getElementById('description').value
            };

            // Debug: Log the values being sent
            console.log('Form data being sent:', formValues);

            // Use URLSearchParams for better compatibility
            const formData = new URLSearchParams();
            Object.keys(formValues).forEach(key => {
                formData.append(key, formValues[key]);
            });

            try {
                // Submit to our API with proper headers
                const response = await fetch('create-payment-link', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    // Display success result
                    document.getElementById('result-content').innerHTML = `
                        <p><strong>Payment Link:</strong></p>
                        <p><a href="${result.data.paymentLink}" target="_blank" class="gp-button gp-button-secondary">${result.data.paymentLink}</a></p>
                        <p><strong>Link ID:</strong> ${result.data.linkId}</p>
                        <p><strong>Reference:</strong> ${result.data.reference}</p>
                        <p><strong>Amount:</strong> ${result.data.amount} ${result.data.currency}</p>
                    `;
                    document.getElementById('result').classList.remove('gp-hidden');
                } else {
                    // Display error with details if available
                    let errorMessage = result.message || 'Unknown error occurred';
                    if (result.error && result.error.details) {
                        errorMessage += ': ' + result.error.details;
                    }
                    document.getElementById('error-content').textContent = errorMessage;
                    document.getElementById('error').classList.remove('gp-hidden');
                }
            } catch (error) {
                // Display network/parsing error
                console.error('Request failed:', error);
                document.getElementById('error-content').textContent = 'Network error: ' + error.message;
                document.getElementById('error').classList.remove('gp-hidden');
            } finally {
                // Reset button state
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        });
    </script>
</body>
</html>